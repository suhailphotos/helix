---
- name: Install Starship on macOS
  when: ansible_facts['system'] == "Darwin"
  community.general.homebrew:
    name: starship
    state: present
    path: "{{ brew_bin | default('/opt/homebrew/bin/brew') }}"

- name: Install Starship via official script (fallback)
  when:
    - ansible_facts.os_family == "Debian"
    - starship_apt is not defined
      or starship_apt.rc | default(1) != 0
  become: yes
  shell: |
    set -e
    curl -fsSL https://starship.rs/install.sh -o /tmp/install_starship.sh
    sh /tmp/install_starship.sh -y -b /usr/local/bin
  args:
    executable: /bin/bash
  changed_when: true

# Fallback: official installer (if apt missing or no starship package)
- name: Install Starship via official script (fallback)
  when:
    - ansible_facts.os_family == "Debian"
    - starship_apt is not defined or starship_apt.rc != 0
  become: yes
  shell: |
    set -e
    curl -fsSL https://starship.rs/install.sh -o /tmp/install_starship.sh
    sh /tmp/install_starship.sh -y -b /usr/local/bin
  args:
    executable: /bin/bash
  changed_when: true
